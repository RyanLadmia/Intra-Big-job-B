#!/usr/bin/env php
<?php

require dirname(__DIR__).'/vendor/autoload.php';

use Symfony\Component\Yaml\Yaml;

// Parse command line arguments
$enableProfiler = false;
$onlyExceptions = true;

foreach ($argv as $arg) {
    if ($arg === '--enable' || $arg === '-e') {
        $enableProfiler = true;
    } elseif ($arg === '--all-requests' || $arg === '-a') {
        $onlyExceptions = false;
    } elseif ($arg === '--help' || $arg === '-h') {
        echo "Usage: php bin/toggle-profiler [options]\n";
        echo "Options:\n";
        echo "  --enable, -e          Enable the profiler (default: disabled)\n";
        echo "  --all-requests, -a    Collect data on all requests, not just exceptions (default: only exceptions)\n";
        echo "  --help, -h            Display this help message\n";
        exit(0);
    }
}

// Create or update profiler settings file
$profilerDir = dirname(__DIR__) . '/config/packages';
$profilerFile = $profilerDir . '/profiler.yaml';

// Convert booleans to string 'true' or 'false' for YAML
$enabledStr = $enableProfiler ? 'true' : 'false';
$onlyExceptionsStr = $onlyExceptions ? 'true' : 'false';

$content = <<<YAML
# This file is auto-generated by the toggle-profiler script
parameters:
    profiler.enabled: {$enabledStr}
    profiler.only_exceptions: {$onlyExceptionsStr}
YAML;

file_put_contents($profilerFile, $content);

// Status message
echo "Symfony Profiler: " . ($enableProfiler ? "ENABLED" : "DISABLED") . "\n";
if ($enableProfiler) {
    echo "Data collection: " . ($onlyExceptions ? "Only on exceptions" : "On all requests") . "\n";
}
echo "Configuration updated in config/packages/profiler.yaml\n";
echo "Please clear the cache for changes to take effect.\n";
echo "Run: php bin/console cache:clear\n"; 